# 시계열 데이터 시각화 프로젝트

원본 데이터베이스에서 조회한 데이터를 적절히 변환하여 통계 데이터베이스에 저장하고, 저장한 데이터를 그래프로 보여줍니다.  
데이터 동기화, 데이터 조회, 데이터 시각화 작업을 **템플릿화**하여, **지속 가능한 확장성**을 제공합니다.

**Tech Stack :** `Next.js 14`, `MUI(Material-UI)`, `TypeScript`, `MySQL`, `MongoDB`.

## 주요 기능

- **데이터 집계 및 시각화 :** 데이터를 년, 월, 일, 시간 기준으로 집계하여 그래프 형태로 시각화합니다.
- **API 기능 :** 데이터를 동기화하고 조회합니다. 사용자는 동기화 기능을 사용하여 데이터를 최신화할 수 있습니다.

## 설치 및 실행 방법

### 1. 통계 데이터 저장소 생성

통계 데이터를 저장하기 위해 **MongoDB의 시계열 컬렉션**을 사용합니다. 따라서 시계열 컬렉션을 지원하는 **5.0 버전 이상**의 MongoDB를 설치해야 합니다.  
설치한 MongoDB에 **데이터베이스**(`database`)와 **시계열 컬렉션**(`data`)을 생성해줍니다. 데이터베이스와 컬렉션의 이름이 반드시 `database`와 `data`일 필요는 없으며, 다른 이름을 사용하는 경우에는 "환경 변수 설정" 과정에서 MongoDB 접속 정보를 수정해야 합니다.

```js
// 데이터베이스 생성 및 사용
use database;

// 시계열 컬렉션 생성
db.data.drop();
db.createCollection("data", {
  timeseries: {
    timeField: "date",
    metaField: "type",
    granularity: "hours",
  },
});
```

### 2. 환경 변수 설정

원본 데이터를 저장하는 **MySQL 접속 정보**와 통계 데이터를 저장하는 **MongoDB 접속 정보**를 `.env` 파일의 환경 변수에 설정합니다.

[환경 변수 설정 파일 보러가기](.env)

### 3. 프로그램 실행

`npm` 명령어로 프로그램을 실행합니다.

```bash
# 의존성 설치
npm install

# 빌드 및 실행
npm run build
npm run start
```

## 데이터 동기화 방법

**데이터 동기화 기능**은 통계 데이터베이스에 없는 **최신 데이터를 추가**하는 기능입니다. 원본 데이터베이스에서 조회한 데이터를 시간 기준으로 집계하고 변환하여 저장합니다. 원본 데이터베이스 부하를 최소화하기 위해 **원본 데이터는 그대로 조회**하고 **집계 및 변환 작업은 프로그램에서 진행**합니다.

이 프로젝트에서 **자료를 구분하는 코드 성격의 단어**는 세 가지가 있습니다.

- **Datum :** 자료의 가장 작은 단위. **시간 정보와 해당 시간에 측정된 값 정보**로 이루어지며, 타입 정의는 [여기](src/types/Datum.ts)에서 확인하실 수 있습니다.
- **Data :** Datum이 모여 만들어진 시계열의 자료. Data에서는 시간 변화에 따른 **추세**를 확인할 수 있습니다.
- **Dataset :** 여러 종류의 Data가 모여 의미를 가지는 자료. Dataset에서는 시간 변화에 따른 **종류별 추세**를 비교할 수 있습니다.

### 1. 데이터 소스 정보 추가

추가할 데이터에 대한 **데이터 소스 정보**를 추가하여, 원본 데이터베이스에서 데이터를 어떻게 조회할 수 있는지 정의합니다.

[데이터 소스 파일 예시 보러가기](src/services/source/bill.ts) (사내 코드 보안을 위해 모든 조회문은 수정하여 사용하였습니다.)

### 2. 데이터 설정 추가

**데이터 설정 파일**의 설정 객체(`config`)에 데이터 설정을 추가합니다. 설정 객체의 `type` 속성은 통계 데이터베이스의 컬렉션에서 데이터 종류를 구분하는 식별값입니다.

[데이터 설정 형식 보러가기](src/types/Config.ts)  
[데이터 설정 파일 보러가기](src/services/config.ts)

### 3. 동기화 시작

홈 화면에서 **모두 동기화** 버튼 또는 **추가된 데이터에 대한 동기화 버튼**을 클릭합니다. 동기화 작업 요청은 **큐**에 저장하여 **순차적으로 하나씩** 처리하게 됩니다.  
**동기화 API**(`/api/sync/[id]`)를 직접 호출하여 요청할 수도 있습니다.

[동기화 큐 보러가기](src/services/sync/SyncQueue.ts)

### 4. 데이터 확인

모든 데이터는 하나의 **시계열 컬렉션**에 저장하며, `type`이라는 **메타데이터로 종류를 구분**합니다. `type`으로 필터링한 데이터의 모든 `date` 값은 유일합니다. 따라서 동일한 `type`에 동일한 `date`가 두 개 이상 있다면 프로그램에 문제가 생긴 것입니다.  
**조회 API**(`/api/get/[id]`)를 호출하여 데이터를 조회할 수 있습니다.

MongoDB에서 데이터를 직접 조회하기 위한 쿼리 설정은 아래와 같습니다.

- Filter : `{type: "bill"}`
- Sort : `{date: 1}

## 그래프 추가 방법

### 1. 페이지 추가

이 프로젝트는 Next.js의 **App Router**를 사용하고 있습니다. 따라서 `app` 폴더 아래에 주소와 동일한 경로로 폴더를 만들고, 해당 폴더에 `page.tsx` 파일을 생성하여 **페이지를 라우팅 목록에 추가**합니다.

[페이지 파일 예시 보러가기](src/app/bill/page.tsx)

### 2. 그래프 컴포넌트 추가

페이지에 그래프 컴포넌트를 추가합니다. 그래프 컴포넌트들은 **제목**, **데이터 식별값**, **집계 기준**, **Y축 서식 변환 함수** 등을 속성으로 받습니다.  
**데이터 식별값 속성**에는 여러 ID를 목록으로 넣을 수 있어, **하나의 그래프에 여러 데이터**를 표시하는 것이 가능합니다.

[라인 그래프 컴포넌트 보러가기](src/components/LineChart.tsx)  
[막대 그래프 컴포넌트 보러가기](src/components/BarChart.tsx)  
[컴포넌트 사용 예시 보러가기](src/app/bill/page.tsx)
